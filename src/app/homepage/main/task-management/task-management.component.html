<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Task Management</h4>
    <button class="btn btn-primary" [routerLink]="['/taskManagement/addtask']">Create New Task</button>
  </div>

  <div class="card">
    <div class="card-body">
      <!-- Filter Section -->
      <div class="mb-4">
        <button class="btn btn-info" (click)="toggleFilter()">Filter By</button>
        <div *ngIf="showFilterOptions" class="mt-3">
          <div class="row">
            <div class="col-md-4">
              <label for="statusFilter">Status:</label>
              <select id="statusFilter" class="form-select" [(ngModel)]="statusFilter">
                <option value="">Status</option>
                <option value="Not Started">Not Started</option>
                <option value="In Progress">In Progress</option>
                <option value="Completed">Completed</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="priorityFilter">Priority:</label>
              <select id="priorityFilter" class="form-select" [(ngModel)]="priorityFilter">
                <option value="">Priority</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
              </select>
            </div>
            <div class="col-md-4 d-flex align-items-center">
              <div class="me-2 flex-grow-1">
                <label for="dueDateFilter">Due Date:</label>
                <input type="date" id="dueDateFilter" class="form-control" [(ngModel)]="dueDateFilter">
              </div>
              <button class="btn btn-primary search-btn" (click)="onSearchClick()">Search</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="row mb-3">
        <div class="col-md-6">
          <input type="text" class="form-control" placeholder="Search" [(ngModel)]="searchTerm" (input)="onSearchClick()">
        </div>
      </div>

      <!-- Task Table Section -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>S.no</th>
              <th>Client Name</th>
              <th>Task Title</th>
              <th>Description</th>
              <th>
                Due Date
                <i (click)="sortTasksBy('dueDate', 'asc')" class="fas fa-arrow-up" [ngClass]="{
                  'text-primary': sortField === 'dueDate' && sortDirection === 'asc'
                }"></i>
                <i (click)="sortTasksBy('dueDate', 'desc')" class="fas fa-arrow-down" [ngClass]="{
                  'text-primary': sortField === 'dueDate' && sortDirection === 'desc'
                }"></i>
              </th>
              <th>
                Priority
                <i (click)="sortTasksBy('priority', 'asc')" class="fas fa-arrow-up" [ngClass]="{
                  'text-primary': sortField === 'priority' && sortDirection === 'asc'
                }"></i>
                <i (click)="sortTasksBy('priority', 'desc')" class="fas fa-arrow-down" [ngClass]="{
                  'text-primary': sortField === 'priority' && sortDirection === 'desc'
                }"></i>
              </th>
              <th>
                Status
                <i (click)="sortTasksBy('status', 'asc')" class="fas fa-arrow-up" [ngClass]="{
                  'text-primary': sortField === 'status' && sortDirection === 'asc'
                }"></i>
                <i (click)="sortTasksBy('status', 'desc')" class="fas fa-arrow-down" [ngClass]="{
                  'text-primary': sortField === 'status' && sortDirection === 'desc'
                }"></i>
              </th>
              <th>Assigned To</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let task of sortedTasks; let i = index">
              <td>{{ i + 1 }}</td>
              <td [innerHTML]="highlightText(task.clientName)"></td>
              <td [innerHTML]="highlightText(task.taskTitle)"></td>
              <td [innerHTML]="highlightText(task.description)"></td>
              <td>{{ task.dueDate | date:'yyyy-MM-dd' }}</td>
              <td [innerHTML]="highlightText(task.priority)"></td>
              <td [innerHTML]="highlightText(task.status)"></td>
              <td [innerHTML]="highlightText(task.assignedTo)"></td>
              <td>
                <button class="btn btn-outline-secondary btn-sm" (click)="onViewTaskClicked(task)">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-outline-secondary btn-sm" (click)="OnEditTaskClicked(task)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm" (click)="deleteTask(task.id, i)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
